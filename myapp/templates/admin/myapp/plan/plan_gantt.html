{% extends "admin/base_site.html" %}
{% load i18n static admin_urls %} {# Añadido admin_urls e i18n para consistencia #}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.css">
    <style>
        .gantt-filters {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: .25rem;
        }
        .gantt-filters label {
            margin-right: 8px;
            font-weight: bold;
        }
        .gantt-filters select,
        .gantt-filters input[type="submit"] {
            padding: .375rem .75rem;
            font-size: 1rem;
            line-height: 1.5;
            border-radius: .25rem;
            border: 1px solid #ced4da;
            margin-right: 15px;
        }
        .gantt-filters input[type="submit"] {
            color: #fff;
            background-color: #007bff;
            border-color: #007bff;
            cursor: pointer;
        }
        .gantt-filters input[type="submit"]:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }
        .gantt-chart-container {
            margin-top: 20px;
            overflow-x: auto; /* Para scroll horizontal si el gantt es muy ancho */
        }
        #gantt .bar-wrapper { cursor: pointer; } /* Para indicar que las barras son clickeables si tienes popups */
    </style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">Inicio</a> &rsaquo;
<a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a> &rsaquo;
<a href="{% url opts|admin_urlname:'changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a> &rsaquo;
{{ title }}
</div>
{% endblock %}

{% block content %}
<div id="content-main">
    <h1>{{ title }}</h1>

    <div class="gantt-filters">
        <form method="get" action="">
            <label for="year-select">Año:</label>
            <select name="year" id="year-select">
                {# Iterar sobre year_options pasadas desde la vista #}
                {% for year_opt in year_options %}
                    <option value="{{ year_opt }}" {% if year_opt == selected_year %}selected{% endif %}>
                        {{ year_opt }}
                    </option>
                {% endfor %}
            </select>

            <label for="responsable-select">Responsable:</label>
            <select name="responsable_id" id="responsable-select">
                <option value="" {% if selected_responsable_id == "" or selected_responsable_id is None %}selected{% endif %}>Todos los Responsables</option>
                {% for responsable in responsables_disponibles %}
                    <option value="{{ responsable.id }}" {% if responsable.id|stringformat:"s" == selected_responsable_id|stringformat:"s" %}selected{% endif %}>
                        {{ responsable.get_full_name|default:responsable.username }}
                    </option>
                {% endfor %}
            </select>

            <input type="submit" value="Filtrar">
        </form>
    </div>

    <div class="gantt-chart-container">
        <svg id="gantt"></svg>
    </div>
</div>
{% endblock %}

{% block extrajs %}
    {{ block.super }}
    <script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.min.js"></script>
    {# Script de prueba simplificado #}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log("PRUEBA: El script dentro de DOMContentLoaded se está ejecutando.");
            document.getElementById('gantt').innerHTML = '<p>Prueba de JavaScript exitosa. El Gantt se inicializaría aquí.</p>';
        });
    </script>
{% endblock %}
